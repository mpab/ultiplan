#!/bin/sh

git pull

npm install -g ts-node
npm install -g yarn

pushd libs
yarn install
yarn unlink
yarn link
popd

pushd cli
yarn install
yarn unlink libs
yarn link libs
popd

pushd api
yarn install
yarn unlink libs
yarn link libs
popd

pushd ui
yarn install
popd

if [ "$(grep -c "ULTIPLAN_HOME" $HOME/.bashrc)" -ge 1 ]; then
    echo "ULTIPLAN_HOME set in $HOME/.bashrc"
else
    echo "ULTIPLAN_HOME not set in $HOME/.bashrc"
    cp $HOME/.bashrc $HOME/.bashrc-pre-ultiplan.bak
    echo "export ULTIPLAN_HOME=$PWD" >> $HOME/.bashrc
fi

mkdir -p $HOME/bin
cp ./bin/tasks $HOME/bin/.
echo "tasks script installed to $(which tasks)"
cp ./bin/tasks-tracker $HOME/bin/.
echo "tasks-tracker script installed to $(which tasks-tracker)"
cp ./bin/tasks-start $HOME/bin/.
echo "tasks-start script installed to $(which tasks-start)"
cp ./bin/tasks-stop $HOME/bin/.
echo "tasks-stop script installed to $(which tasks-stop)"
cp ./bin/tasks-api $HOME/bin/.
echo "tasks-api script installed to $(which tasks-api)"
cp ./bin/tasks-ui $HOME/bin/.
echo "tasks-ui script installed to $(which tasks-ui)"
cp ./bin/tasks-diff $HOME/bin/.
echo "tasks-diff script installed to $(which tasks-diff)"
